apiVersion: v1
kind: ConfigMap
metadata:
  name: sub-processor-env
  namespace: sub-back
data:

  CHAIN_NODE: "wss://arch.subsocial.network"
  BATCH_SIZE: "500"
  BLOCK_WINDOW: "100000"

# PostgreSQL config
  DB_HOST: "10.110.0.2"
  DB_NAME: "subsocial_processor"
  DB_USER: "subsocial_processor_usr"
  DB_PASS: "oq3yeNto3"
  DB_PORT: "5432"
  POLL_INTERVAL_MS: "300"
# .env file
  PROJECT_NAME: "subsocial-hydra"
  DEBUG: "index-builder:*"
  TYPEORM_LOGGING: "error"
  WARTHOG_DB_HOST: "10.110.0.2"
  
  INDEXER_ENDPOINT_URL: "http://sub-indexer-gw:4000/v1/graphql"


  GRAPHQL_SERVER_PORT: "4000"
  GRAPHQL_SERVER_HOST: "localhost"
  WARTHOG_APP_PORT: "4000"
  WARTHOG_APP_HOST: "localhost"
  ID: "subsocial"
  
  SUBSTRATE_URL: "wss://arch.subsocial.network"  

  IPFS_READ_ONLY_NODE_URL: "https://app.subsocial.network/ipfs" 

--- 

apiVersion: apps/v1
kind: Deployment
metadata:
  name: sub-processor
  namespace: sub-back
  labels:
    app: sub-processor
spec:
  replicas: 1
  template:
    metadata:
      name: sub-processor
      labels:
        app: sub-processor
    spec:
      containers:
        - name: sub-processor
          image: <IMAGE> 
          imagePullPolicy: IfNotPresent
          command:
            ['sh', '-c', 'yarn db:create  && yarn processor:migrate && yarn db:migrate && yarn processor:start']            
          ports:
            - containerPort: 8080
          envFrom:
            - configMapRef:
                name: sub-processor-env

      restartPolicy: Always
  selector:
    matchLabels:
      app: sub-processor

